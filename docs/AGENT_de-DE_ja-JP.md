# KIエージェント（ReAct）

## エージェント（ReAct）とは

エージェントは、大規模言語モデル（Large Language Models、LLM）を中心的な計算モジュールとして使用する先進的なAIシステムです。LLMの推論能力を、計画や道具の使用などの追加機能と組み合わせ、複雑なタスクを自律的に実行します。エージェントは複雑な問い合わせを分解し、段階的なソリューションを生成し、外部のツールやAPIと対話して情報を収集したり、サブタスクを実行したりできます。

この実装では、[ReAct（Reasoning + Acting）](https://www.promptingguide.ai/techniques/react)アプローチを使用するエージェントを採用しています。ReActにより、エージェントは推論とアクションを反復的なフィードバックループで組み合わせることで、複雑なタスクを解決できます。エージェントは、思考、行動、観察の3つの重要なステップを繰り返し実行します。LLMを使用して現在の状況を分析し、次のアクションを決定し、利用可能なツールやAPIでアクションを実行し、観察された結果から学習します。この継続的なプロセスにより、エージェントは動的な環境に適応し、タスク解決の精度を向上させ、文脈に応じたソリューションを提供できます。

## 使用例

ReActを使用するエージェントは、さまざまなシナリオで展開され、精密かつ効率的なソリューションを提供できます。

### テキストからSQL

ユーザーが「前四半期の総売上」を尋ねます。エージェントはこのリクエストを解釈し、SQL問い合わせに変換し、データベースに対して実行し、結果を提示します。

### 財務予測

財務アナリストが次の四半期の売上予測を必要とします。エージェントは関連データを収集し、財務モデルを使用して必要な計算を実行し、予測の精度を確保する詳細な予測レポートを生成します。

## Agent関数の使用

カスタムチャットボットのAgent機能を有効にするには、次の手順に従ってください：

1. カスタムボット画面のAgent セクションに移動します。

2. Agentセクションには、Agentが利用可能なツールのリストがあります。デフォルトでは、すべてのツールは無効になっています。

3. ツールを有効にするには、目的のツールの横にあるスイッチを切り替えるだけです。ツールが有効になると、Agentはそのツールにアクセスでき、ユーザーリクエストの処理に使用できます。

![](./imgs/agent_tools.png)

> [!重要]
> Agentセクションでツールを有効にすると、自動的に["Knowledge"機能](https://aws.amazon.com/what-is/retrieval-augmented-generation/)もツールとして扱われます。これは、LLMが独自にユーザーリクエストに答える際に「Knowledge」を使用するかどうかを決定し、それを利用可能なツールの1つとして扱うことを意味します。

4. デフォルトで「インターネット検索」ツールが提供されています。このツールにより、Agentはインターネットから情報を取得し、ユーザーの質問に答えることができます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは[DuckDuckGo](https://duckduckgo.com/)に基づいており、レート制限があります。概念実証やデモンストレーションには適していますが、本番環境では別の検索APIの使用をお勧めします。

5. Agentの機能を拡張するために、独自のカスタムツールを開発して追加することができます。カスタムツールの作成と統合の詳細については、[独自のツールの開発](#how-to-develop-your-own-tools)セクションを参照してください。

## 独自のツールを開発する方法

独自のカスタムツールをエージェント用に開発するには、以下のガイドラインに従ってください：

- `AgentTool`クラスを継承する新しいクラスを作成します。LangChainと互換性のあるインターフェースですが、この実装例では独自の`AgentTool`クラスを提供しており、そこから継承する必要があります（[ソース](../backend/app/agents/tools/agent_tool.py)）。

- [BMI計算ツール](../examples/agents/tools/bmi/bmi.py)の実装例を参照してください。このサンプルは、ユーザー入力に基づいてBMI（体格指数）を計算するツールを作成する方法を示しています。

  - ツールに宣言される名前と説明は、LLMがユーザーの質問に答えるためにどのツールを使用するかを決定する際に使用されます。言い換えれば、LLMが呼び出されるときに入力プロンプトに埋め込まれます。そのため、できるだけ正確に記述することをお勧めします。

- [オプション] カスタムツールを実装したら、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）でその機能を確認することをお勧めします。このスクリプトは、ツールが期待通りに動作することを確認するのに役立ちます。

- カスタムツールの開発とテストが完了したら、実装ファイルを[backend/app/agents/tools/](../backend/app/agents/tools/)ディレクトリに移動します。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py)を開き、`get_available_tools`を編集して、ユーザーが開発したツールを選択できるようにします。

- [オプション] フロントエンド用にわかりやすい名前と説明を追加します。このステップはオプションですが、実行しない場合、ツールで宣言された名前と説明が使用されます。これらはLLM用に意図されていますが、ユーザー向けではないため、ユーザーエクスペリエンスを向上させるための専用の説明を追加することをお勧めします。

  - i18nファイルを編集します。[en/index.ts](../frontend/src/i18n/en/index.ts)を開き、`agent.tools`に独自の`name`と`description`を追加します。
  - 使用する言語コードの`xx/index.ts`も編集します。

- `npx cdk deploy`を実行して変更をデプロイします。これにより、カスタムツールがカスタムボット画面で利用可能になります。

## 貢献

**ツールリポジトリへの貢献を歓迎しています！** 有用で適切に実装されたツールを開発した場合は、Issue またはプルリクエストを提出して、プロジェクトにツールを追加することをご検討ください。