# 大規模言語モデルに基づくインテリジェントエージェント（ReAct）

## ReAct（推論と行動）とは何か？

ReActは、大規模言語モデル（LLM）をそのコア計算エンジンとする高度な人工知能システムです。大規模言語モデルの推論能力を、計画や道具の使用などの追加機能と組み合わせて、複雑なタスクを自律的に実行します。ReActは複雑な問い合わせを分解し、段階的な解決策を生成し、外部のツールやAPIと対話して情報を収集したり、サブタスクを実行したりすることができます。

この例では、[ReAct（推論 + 行動）](https://www.promptingguide.ai/techniques/react)メソッドを使用してReActを実装しています。ReActは、推論と行動を反復フィードバックループで組み合わせることで、複雑なタスクを解決できるようにします。ReActは、思考、行動、観察の3つの重要なステップを繰り返し経験します。大規模言語モデルを使用して現在の状況を分析し、次に取るべき行動を決定し、利用可能なツールやAPIを使用してその行動を実行し、観察された結果から学習します。この継続的なプロセスにより、ReActは動的な環境に適応し、タスク解決の精度を向上させ、コンテキストを意識した解決策を提供できます。

## 使用例

様々なシナリオにおいて、ReAct を使用するエージェントは正確かつ効率的な解決策を提供できます。

### テキストから SQL へ

ユーザーが「前四半期の総売上高」について尋ねます。エージェントはこのリクエストを解釈し、SQL クエリに変換し、データベースに対してクエリを実行し、結果を提示します。

### 財務予測

財務アナリストが次の四半期の収益を予測する必要があります。エージェントは関連データを収集し、財務モデルを使用して必要な計算を行い、予測の正確性を確保しながら詳細な予測レポートを生成します。

## プロキシ機能の使用

カスタムチャットボットのプロキシ機能を有効にするには、以下の手順に従ってください：

1. カスタムボットインターフェースでプロキシセクションに移動します。

2. プロキシセクションでは、プロキシで使用可能なツールのリストが表示されます。デフォルトでは、すべてのツールは無効になっています。

3. ツールをアクティブ化するには、目的のツールの横にあるスイッチを切り替えるだけです。ツールが有効になると、プロキシはそれにアクセスし、ユーザークエリの処理に使用できるようになります。

![](./imgs/agent_tools.png)

> [!重要]
> プロキシセクションでどのツールを有効にしても、["ナレッジ"機能](https://aws.amazon.com/what-is/retrieval-augmented-generation/)は自動的にツールとして扱われることに注意してください。これは、大規模言語モデルがユーザークエリに答える際に、"ナレッジ"を使用するかどうかを自律的に決定し、それを利用可能なツールの1つとして扱うことを意味します。

4. デフォルトで「インターネット検索」ツールが提供されています。このツールにより、プロキシはユーザーの質問に答えるためにインターネットから情報を取得できます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは[DuckDuckGo](https://duckduckgo.com/)に依存しており、レート制限があります。概念実証やデモンストレーションには適していますが、本番環境で使用する場合は、他の検索APIの使用をお勧めします。

5. プロキシの機能を拡張するために、独自のカスタムツールを開発して追加することができます。カスタムツールの作成と統合の詳細については、[独自のツールを開発する方法](#how-to-develop-your-own-tools)セクションを参照してください。

## カスタムツールの開発方法

エージェント用のカスタムツールを開発するには、以下のガイドラインに従ってください：

- `AgentTool` クラスを継承する新しいクラスを作成します。インターフェースは LangChain と互換性がありますが、この例の実装は独自の `AgentTool` クラスを提供しており、そのクラスから継承する必要があります（[ソースコード](../backend/app/agents/tools/agent_tool.py)）。

- [BMI 計算ツール](../examples/agents/tools/bmi/bmi.py)の実装例を参照してください。この例は、ユーザー入力に基づいて体格指数（BMI）を計算するツールの作成方法を示しています。

  - ツールで宣言された名前と説明は、LLM がユーザーの質問に応答するためにどのツールを使用すべきかを検討する際に使用されます。言い換えれば、それらは LLM を呼び出すプロンプトに埋め込まれています。したがって、できるだけ正確に説明することをお勧めします。

- [オプション] カスタムツールを開発した後、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）を使用してその機能を検証することをお勧めします。このスクリプトは、ツールが期待通りに動作することを確認するのに役立ちます。

- カスタムツールの開発とテストが完了したら、実装ファイルを [backend/app/agents/tools/](../backend/app/agents/tools/) ディレクトリに移動します。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py) を開き、`get_available_tools` を編集して、ユーザーが開発したツールを選択できるようにします。

- [オプション] フロントエンド用に分かりやすい名前と説明を追加します。このステップはオプションですが、実行しない場合は、ツール内で宣言されたツール名と説明が使用されます。これらは LLM 用に準備されたものであり、ユーザー向けではないため、より良いユーザーエクスペリエンスを得るために特定の説明を追加することをお勧めします。

  - 国際化ファイルを編集します。[en/index.ts](../frontend/src/i18n/en/index.ts) を開き、`agent.tools` に独自の `name` と `description` を追加します。
  - 同時に `xx/index.ts` も編集します。`xx` は希望の国/地域コードを表します。

- `npx cdk deploy` を実行して変更をデプロイします。これにより、カスタムツールがカスタムボット画面で利用可能になります。

## コントリビューション

**このツールリポジトリへのコントリビューションを歓迎します！** 有用で適切に実装されたツールを開発した場合は、Issue の作成またはプルリクエストを通じてプロジェクトに貢献することを検討してください。