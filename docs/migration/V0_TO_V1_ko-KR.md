# 마이그레이션 가이드 (v0 에서 v1로)

이미 이전 버전(~`0.4.x`)의 Bedrock Chat을 사용하고 있다면, 아래 단계를 따라 마이그레이션해야 합니다.

## 왜 해야 하나요?

이 주요 업데이트에는 중요한 보안 업데이트가 포함되어 있습니다.

- 벡터 데이터베이스(즉, Aurora PostgreSQL의 pgvector) 스토리지가 이제 암호화되어 있으며, 배포 시 교체가 트리거됩니다. 이는 기존 벡터 항목이 삭제됨을 의미합니다.
- 봇 생성을 제한하기 위해 `CreatingBotAllowed` Cognito 사용자 그룹을 도입했습니다. 현재 기존 사용자는 이 그룹에 속해 있지 않으므로, 봇 생성 권한을 원하는 경우 수동으로 권한을 부여해야 합니다. 참조: [봇 개인화](../../README.md#bot-personalization)

## 사전 요구 사항

[데이터베이스 마이그레이션 가이드](./DATABASE_MIGRATION_ko-KR.md)를 읽고 항목 복원 방법을 결정하세요.

## 단계

### 벡터 저장소 마이그레이션

- 터미널을 열고 프로젝트 디렉터리로 이동
- 배포하려는 브랜치를 가져옵니다. 다음은 원하는 브랜치(이 경우 `v1`)로 전환하고 최신 변경 사항을 가져옵니다:

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMS로 항목을 복원하려면 비밀번호 순환을 비활성화하고 데이터베이스에 액세스할 비밀번호를 기록해야 합니다. 마이그레이션 스크립트([migrate_v0_v1.py](./migrate_v0_v1.py))로 복원하는 경우 비밀번호를 기록할 필요가 없습니다.
- CloudFormation이 기존 Aurora 클러스터를 제거할 수 있도록 모든 [게시된 API](../PUBLISH_API_ko-KR.md)를 제거합니다.
- [npx cdk deploy](../README.md#deploy-using-cdk)를 실행하면 Aurora 클러스터 교체가 트리거되고 모든 벡터 항목이 삭제됩니다.
- [데이터베이스 마이그레이션 가이드](./DATABASE_MIGRATION_ko-KR.md)를 따라 벡터 항목을 복원합니다.
- 사용자가 기존 봇(즉, RAG 봇)을 활용할 수 있는지 확인합니다.

### CreatingBotAllowed 권한 부여

- 배포 후 모든 사용자는 새 봇을 생성할 수 없게 됩니다.
- 특정 사용자가 봇을 생성할 수 있게 하려면 관리 콘솔 또는 CLI를 사용하여 해당 사용자를 `CreatingBotAllowed` 그룹에 추가합니다.
- 사용자가 봇을 생성할 수 있는지 확인합니다. 사용자는 다시 로그인해야 합니다.