# マイグレーションガイド (v0 から v1)

既に Bedrock Claude Chat の以前のバージョン（〜`0.4.x`）を使用している場合は、以下の移行手順に従う必要があります。

## なぜこれを行う必要があるのか？

この包括的な更新には重要なセキュリティ更新が含まれています。

- ベクターデータベースストレージ（つまり、Aurora PostgreSQLの pgvector）が暗号化され、デプロイメント時に交換が発生します。これは、既存のベクター要素が削除されることを意味します。
- Botを作成できるユーザーを制限するために、`CreatingBotAllowed` という Cognito ユーザーグループを導入しました。既存のユーザーはこのグループに含まれていないため、Botの作成権限を付与する場合は手動で権限を割り当てる必要があります。詳細については、[Botのパーソナライズ](../../README.md#bot-personalization)を参照してください。

## 前提条件

[データベース移行ガイド](./DATABASE_MIGRATION_de-DE_ja-JP.md)を読み、要素を復元する方法を決定してください。

## 手順

### ベクトルストレージの移行

- ターミナルを開き、プロジェクトディレクトリに移動します
- デプロイするブランチをプルします。目的のブランチ（この場合は `v1`）に切り替え、最新の変更を取得します：

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMSで要素を復元する場合、パスワードローテーションを無効にし、データベースアクセス用のパスワードをメモすることを忘れないでください。移行スクリプト（[migrate_v0_v1.py](./migrate_v0_v1.py)）を使用する場合、パスワードをメモする必要はありません。
- CloudFormationが既存のAuroraクラスターを削除できるように、[公開されたAPI](../PUBLISH_API_de-DE_ja-JP.md)をすべて削除します。
- [npx cdk deploy](../README.md#deploy-using-cdk)を実行して、Auroraクラスターを置き換え、すべてのベクトル要素を削除します。
- [データベース移行ガイド](./DATABASE_MIGRATION_de-DE_ja-JP.md)に従って、ベクトル要素を復元します。
- ユーザーが知識を持つ既存のボットを利用できることを確認します。つまり、RAGボット。

### ボット作成権限の追加

- デプロイ後、すべてのユーザーは新しいボットを作成できません。
- 特定のユーザーにボットの作成を許可する場合は、管理コンソールまたはコマンドラインインターフェースを使用して、そのユーザーを `CreatingBotAllowed` グループに追加します。
- ユーザーがボットを作成できることを確認します。ユーザーは再ログインする必要があることに注意してください。