# マイグレーションガイド (v0 から v1)

既に以前のバージョン（〜`0.4.x`）のBedrock Claude Chatを使用している場合、以下の手順に従ってマイグレーションする必要があります。

## なぜこれを行う必要があるのか?

この重要な更新には、重要なセキュリティ更新が含まれています。

- ベクターデータベースストレージ（Aurora PostgreSQLの`pgvector`など）が現在暗号化されており、現在使用中の置き換えがトリガーされます。これは、既存のベクターアイテムが削除されることを意味します。
- Cognitoユーザーグループ`CreatingBotAllowed`を導入し、ボットを作成できるユーザーを制限します。既存のユーザーはこのグループに属していないため、ボットを作成する機能を持たせたい場合は、手動で権限を付与する必要があります。詳細は: [ボットのパーソナライズ](../../README.md#bot-personalization)

## 前提条件

[データベース移行ガイド](./DATABASE_MIGRATION_ms-MY_ja-JP.md)を読み、アイテムを復元する方法を決定してください。

## 手順

### ベクターストアの移行

- ターミナルを開き、プロジェクトディレクトリに移動します
- デプロイしたいブランチをチェックアウトします。目的のブランチ（この場合は `v1`）をチェックアウトし、最新の変更を取得します：

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMSでアイテムを復元する場合、パスワードローテーションを無効にし、データベースにアクセスするためのパスワードをメモしてください。移行スクリプト([migrate_v0_v1.py](./migrate_v0_v1.py))で復元する場合は、パスワードをメモする必要はありません。
- 既存のAuroraクラスターを解放できるように、[公開されたAPI](../PUBLISH_API_ms-MY_ja-JP.md)をすべて解放します。
- [npx cdk deploy](../README.md#deploy-using-cdk)を実行して、Auroraクラスターの置き換えを起動し、すべてのベクターアイテムを削除します。
- [データベース移行ガイド](./DATABASE_MIGRATION_ms-MY_ja-JP.md)に従って、ベクターアイテムを復元します。
- 既存のナレッジを持つボット（RAGボット）をユーザーが使用できることを確認します。

### CreatingBotAllowedの権限を追加

- デプロイ後、すべてのユーザーは新しいボットを作成できなくなります。
- 特定のユーザーにボット作成を許可する場合は、管理コンソールまたはCLIを使用して、そのユーザーを `CreatingBotAllowed` グループに追加します。
- ユーザーがボットを作成できるかどうかを確認します。ユーザーは再ログインする必要があることに注意してください。