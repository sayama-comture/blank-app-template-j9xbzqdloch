# マイグレーションガイド (v0 から v1)

既に Bedrock Claude Chat の以前のバージョン (~`0.4.x`）を使用している場合は、以下の手順に従ってマイグレーションする必要があります。

## なぜこれを行う必要があるのですか？

この大規模な更新には重要なセキュリティ更新が含まれています。

- ベクトルデータベースストレージ（つまり、Aurora PostgreSQLの pgvector）が現在暗号化されており、デプロイ時に置き換えが発生します。これは、既存のベクトルオブジェクトが削除されることを意味します。
- ボットを作成できるユーザーを制限するために、Cognitoユーザーグループ `CreatingBotAllowed` を導入しました。既存のユーザーはこのグループに属していないため、ボット作成を許可する場合は、手動で権限を追加する必要があります。詳細は：[ボットのパーソナライズ](../../README.md#bot-personalization)

## 前提条件

[データベース移行ガイド](./DATABASE_MIGRATION_nb-NO_ja-JP.md)を読み、要素の復元方法を決定してください。

## 手順

### ベクターストレージ移行

- ターミナルを開き、プロジェクトディレクトリに移動します
- 配布したいブランチをチェックアウトします。目的のブランチ（この場合は `v1`）に切り替え、最新の変更を取得します：

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMSでアイテムを復元する場合、パスワードローテーションを無効にし、データベースにアクセスするためのパスワードを必ず控えてください。移行スクリプト([migrate_v0_v1.py](./migrate_v0_v1.py))で復元する場合は、パスワードを控える必要はありません。
- CloudFormationが既存のAuroraクラスターを削除できるように、[公開されたAPI](../PUBLISH_API_nb-NO_ja-JP.md)をすべて削除します。
- Auroraクラスターを置き換え、すべてのベクターアイテムを**削除**する[npx cdk deploy](../README.md#deploy-using-cdk)を実行します。
- [データベース移行ガイド](./DATABASE_MIGRATION_nb-NO_ja-JP.md)に従って、ベクターアイテムを復元します。
- ユーザーが既存の知識を持つボット（RAGボット）を使用できることを確認します。

### CreatingBotAllowed権限の追加

- 配布後、すべてのユーザーは新しいボットを作成できなくなります。
- 特定のユーザーにボットの作成を許可する場合は、管理コンソールまたはCLIを使用して、これらのユーザーを`CreatingBotAllowed`グループに追加します。
- ユーザーがボットを作成できることを確認します。ユーザーは再ログインする必要があることに注意してください。