# คู่มือการย้ายเวอร์ชัน (จาก v2 ไปยัง v3)

## สรุปย่อ

- V3 นำเสนอการควบคุมสิทธิ์แบบละเอียดและฟังก์ชันร้านค้าบอท ซึ่งต้องการการเปลี่ยนแปลงสคีมา DynamoDB
- **สำรองข้อมูลตาราง ConversationTable ของ DynamoDB ก่อนการย้ายข้อมูล**
- อัปเดต URL ของคลังโค้ดจาก `bedrock-claude-chat` เป็น `bedrock-chat`
- เรียกใช้สคริปต์การย้ายข้อมูลเพื่อแปลงข้อมูลเป็นสคีมาใหม่
- บอทและการสนทนาทั้งหมดของคุณจะถูกเก็บรักษาไว้ด้วยโมเดลสิทธิ์ใหม่
- **สำคัญ: ระหว่างกระบวนการย้ายข้อมูล แอปพลิเคชันจะไม่พร้อมใช้งานสำหรับผู้ใช้ทั้งหมดจนกว่าการย้ายข้อมูลจะเสร็จสิ้น กระบวนการนี้ใช้เวลาประมาณ 60 นาที ขึ้นอยู่กับปริมาณข้อมูลและประสิทธิภาพของสภาพแวดล้อมการพัฒนาของคุณ**
- **สำคัญ: API ที่เผยแพร่ทั้งหมดต้องถูกลบระหว่างกระบวนการย้ายข้อมูล**
- **คำเตือน: กระบวนการย้ายข้อมูลไม่สามารถรับประกันความสำเร็จ 100% สำหรับบอททั้งหมด โปรดบันทึกการตั้งค่าบอทที่สำคัญก่อนการย้ายข้อมูลในกรณีที่คุณต้องสร้างใหม่ด้วยตนเอง**

## บทนำ

### มีอะไรใหม่ใน V3

V3 นำการปรับปรุงที่สำคัญมาสู่ Bedrock Chat:

1. **การควบคุมสิทธิ์แบบละเอียด**: ควบคุมการเข้าถึงบอทของคุณด้วยสิทธิ์ตามกลุ่มผู้ใช้
2. **Bot Store**: แชร์และค้นพบบอทผ่านตลาดกลาง
3. **คุณสมบัติการดูแลระบบ**: จัดการ API, ทำเครื่องหมายบอทเป็นสำคัญ และวิเคราะห์การใช้งานบอท

คุณสมบัติใหม่เหล่านี้จำเป็นต้องเปลี่ยนแปลงโครงสร้างข้อมูล DynamoDB ซึ่งต้องใช้กระบวนการย้ายข้อมูลสำหรับผู้ใช้ที่มีอยู่

### ทำไมต้องมีการย้ายข้อมูลนี้

รูปแบบสิทธิ์ใหม่และฟังก์ชัน Bot Store จำเป็นต้องปรับโครงสร้างวิธีการจัดเก็บและเข้าถึงข้อมูลบอท กระบวนการย้ายข้อมูลจะแปลงบอทและการสนทนาที่มีอยู่ของคุณเป็นโครงสร้างใหม่ โดยยังคงข้อมูลทั้งหมดไว้

> [!คำเตือน]
> ประกาศการหยุดให้บริการ: **ระหว่างกระบวนการย้ายข้อมูล แอปพลิเคชันจะไม่พร้อมใช้งานสำหรับผู้ใช้ทั้งหมด** วางแผนดำเนินการย้ายข้อมูลในช่วงเวลาบำรุงรักษาที่ผู้ใช้ไม่จำเป็นต้องเข้าใช้ระบบ แอปพลิเคชันจะพร้อมใช้งานอีกครั้งหลังจากสคริปต์ย้ายข้อมูลดำเนินการสำเร็จและแปลงข้อมูลเป็นโครงสร้างใหม่เรียบร้อยแล้ว กระบวนการนี้ใช้เวลาประมาณ 60 นาที ขึ้นอยู่กับปริมาณข้อมูลและประสิทธิภาพของสภาพแวดล้อมการพัฒนาของคุณ

> [!สำคัญ]
> ก่อนดำเนินการย้ายข้อมูล: **กระบวนการย้ายข้อมูลไม่สามารถรับประกันความสำเร็จ 100% สำหรับบอททั้งหมด** โดยเฉพาะอย่างยิ่งบอทที่สร้างด้วยเวอร์ชันเก่าหรือการตั้งค่าแบบกำหนดเอง กรุณาบันทึกการตั้งค่าบอทที่สำคัญ (คำแนะนำ แหล่งความรู้ การตั้งค่า) ก่อนเริ่มกระบวนการย้ายข้อมูลในกรณีที่คุณต้องสร้างใหม่ด้วยตนเอง

## กระบวนการย้ายข้อมูล

### ประกาศสำคัญเกี่ยวกับการมองเห็นของบอทใน V3

ใน V3 **บอท v2 ทั้งหมดที่เปิดใช้งานการแชร์สาธารณะจะสามารถค้นหาได้ในร้านค้าบอท** หากคุณมีบอทที่มีข้อมูลที่ละเอียดอ่อนซึ่งคุณไม่ต้องการให้ค้นพบ ให้พิจารณาทำให้เป็นส่วนตัวก่อนย้ายข้อมูลไปยัง V3

### ขั้นตอนที่ 1: ระบุชื่อสภาพแวดล้อมของคุณ

ในขั้นตอนนี้ `{YOUR_ENV_PREFIX}` ถูกระบุเพื่อระบุชื่อของ CloudFormation Stacks ของคุณ หากคุณกำลังใช้คุณสมบัติ [Deploying Multiple Environments](../../README.md#deploying-multiple-environments) ให้แทนที่ด้วยชื่อสภาพแวดล้อมที่จะย้ายข้อมูล หากไม่ใช่ ให้แทนที่ด้วยสตริงว่าง

### ขั้นตอนที่ 2: อัปเดต Repository URL (แนะนำ)

ที่เก็บข้อมูลได้เปลี่ยนชื่อจาก `bedrock-claude-chat` เป็น `bedrock-chat` อัปเดตที่เก็บข้อมูลในเครื่องของคุณ:

```bash
# ตรวจสอบ URL รีโมตปัจจุบันของคุณ
git remote -v

# อัปเดต URL รีโมต
git remote set-url origin https://github.com/aws-samples/bedrock-chat.git

# ตรวจสอบการเปลี่ยนแปลง
git remote -v
```

### ขั้นตอนที่ 3: ตรวจสอบว่าคุณอยู่ในเวอร์ชันล่าสุดของ V2

> [!WARNING]
> คุณต้องอัปเดตเป็น v2.10.0 ก่อนย้ายข้อมูลไปยัง V3 **การข้ามขั้นตอนนี้อาจทำให้เกิดการสูญเสียข้อมูลระหว่างการย้ายข้อมูล**

ก่อนเริ่มการย้ายข้อมูล ตรวจสอบให้แน่ใจว่าคุณกำลังใช้เวอร์ชันล่าสุดของ V2 (**v2.10.0**) เพื่อให้มั่นใจว่ามีการแก้ไขข้อบกพร่องและการปรับปรุงที่จำเป็นก่อนอัปเกรดเป็น V3:

```bash
# ดึงแท็กล่าสุด
git fetch --tags

# สลับไปยังเวอร์ชัน V2 ล่าสุด
git checkout v2.10.0

# ปรับใช้เวอร์ชัน V2 ล่าสุด
cd cdk
npm ci
npx cdk deploy --all
```

### ขั้นตอนที่ 4: บันทึกชื่อตาราง DynamoDB ของ V2

รับชื่อตาราง ConversationTable จาก CloudFormation outputs:

```bash
# รับชื่อตาราง V2 ConversationTable
aws cloudformation describe-stacks \
  --output text \
  --query "Stacks[0].Outputs[?OutputKey=='ConversationTableName'].OutputValue" \
  --stack-name {YOUR_ENV_PREFIX}BedrockChatStack
```

ตรวจสอบให้แน่ใจว่าบันทึกชื่อตารางนี้ไว้ในตำแหน่งที่ปลอดภัย เนื่องจากคุณจะต้องใช้ในสคริปต์ย้ายข้อมูลในภายหลัง

### ขั้นตอนที่ 5: สำรองตาราง DynamoDB

ก่อนดำเนินการต่อ ให้สร้างสำเนาสำรอง ConversationTable ของ DynamoDB โดยใช้ชื่อที่คุณเพิ่งบันทึก:

```bash
# สร้างสำเนาสำรองของตาราง V2
aws dynamodb create-backup \
  --no-cli-pager \
  --backup-name "BedrockChatV2Backup-$(date +%Y%m%d)" \
  --table-name YOUR_V2_CONVERSATION_TABLE_NAME

# ตรวจสอบสถานะสำเนาสำรองว่าพร้อมใช้งาน
aws dynamodb describe-backup \
  --no-cli-pager \
  --query BackupDescription.BackupDetails \
  --backup-arn YOUR_BACKUP_ARN
```

[ส่วนที่เหลือของเอกสารจะถูกแปลในรูปแบบเดียวกัน]

## คำถามที่พบบ่อย V3

### การเข้าถึงบอทและสิทธิอนุญาต

**ถาม: เกิดอะไรขึ้นหากบอทที่ฉันใช้ถูกลบหรือสิทธิการเข้าถึงของฉันถูกเอาออก?**
ตอบ: การตรวจสอบสิทธิอนุญาตจะทำในขณะแชท ดังนั้นคุณจะสูญเสียการเข้าถึงทันที

**ถาม: เกิดอะไรขึ้นหากผู้ใช้ถูกลบ (เช่น พนักงานลาออก)?**
ตอบ: ข้อมูลของพวกเขาสามารถลบได้อย่างสมบูรณ์โดยการลบรายการทั้งหมดจาก DynamoDB ด้วย user ID เป็นพาร์ติชันคีย์ (PK)

**ถาม: ฉันสามารถปิดการแชร์สำหรับบอทสาธารณะที่สำคัญได้หรือไม่?**
ตอบ: ไม่ได้ ผู้ดูแลระบบต้องทำเครื่องหมายบอทว่าไม่สำคัญก่อนจึงจะปิดการแชร์ได้

**ถาม: ฉันสามารถลบบอทสาธารณะที่สำคัญได้หรือไม่?**
ตอบ: ไม่ได้ ผู้ดูแลระบบต้องทำเครื่องหมายบอทว่าไม่สำคัญก่อนจึงจะลบได้

### ความปลอดภัยและการใช้งาน

**ถาม: มีการใช้การรักษาความปลอดภัยระดับแถว (RLS) สำหรับตารางบอทหรือไม่?**
ตอบ: ไม่มี เนื่องจากมีรูปแบบการเข้าถึงที่หลากหลาย การตรวจสอบสิทธิอนุญาตจะทำเมื่อเข้าถึงบอท และความเสี่ยงของการรั่วไหลข้อมูลเมตาถือว่าน้อยเมื่อเทียบกับประวัติการสนทนา

**ถาม: ข้อกำหนดสำหรับการเผยแพร่ API คืออะไร?**
ตอบ: บอทต้องเป็นสาธารณะ

**ถาม: จะมีหน้าจัดการสำหรับบอทส่วนตัวทั้งหมดหรือไม่?**
ตอบ: ไม่มีในการปล่อย V3 เริ่มแรก อย่างไรก็ตาม สามารถลบรายการได้โดยการค้นหาด้วย user ID ตามความจำเป็น

**ถาม: จะมีฟังก์ชันการติดแท็กบอทเพื่อปรับปรุงประสบการณ์การค้นหาหรือไม่?**
ตอบ: ไม่มีในการปล่อย V3 เริ่มแรก แต่อาจเพิ่มการติดแท็กอัตโนมัติด้วย LLM ในการอัปเดตในอนาคต

### การดูแลระบบ

**ถาม: ผู้ดูแลระบบสามารถทำอะไรได้บ้าง?**
ตอบ: ผู้ดูแลระบบสามารถ:

- จัดการบอทสาธารณะ (รวมถึงการตรวจสอบบอทที่มีต้นทุนสูง)
- จัดการ API
- ทำเครื่องหมายบอทสาธารณะเป็นสำคัญ

**ถาม: ฉันสามารถทำบอทที่แชร์บางส่วนเป็นสำคัญได้หรือไม่?**
ตอบ: ไม่ได้ สนับสนุนเฉพาะบอทสาธารณะเท่านั้น

**ถาม: ฉันสามารถตั้งลำดับความสำคัญสำหรับบอทที่ปักหมุดได้หรือไม่?**
ตอบ: ในการปล่อยเริ่มแรก ทำไม่ได้

### การกำหนดค่าการอนุญาต

**ถาม: ฉันจะตั้งค่าการอนุญาตอย่างไร?**
ตอบ:

1. เปิดคอนโซล Amazon Cognito และสร้างกลุ่มผู้ใช้ในยูสเซอร์พูล BrChat
2. เพิ่มผู้ใช้ลงในกลุ่มตามความจำเป็น
3. ใน BrChat เลือกกลุ่มผู้ใช้ที่คุณต้องการอนุญาตการเข้าถึงเมื่อกำหนดค่าการแชร์บอท

หมายเหตุ: การเปลี่ยนแปลงสมาชิกกลุ่มต้องทำการเข้าสู่ระบบใหม่เพื่อมีผล การเปลี่ยนแปลงจะสะท้อนในการรีเฟรชโทเคน แต่ไม่ในช่วงอายุโทเคน ID (ค่าเริ่มต้น 30 นาทีใน V3 สามารถกำหนดค่าได้ด้วย `tokenValidMinutes` ใน `cdk.json` หรือ `parameter.ts`)

**ถาม: ระบบตรวจสอบกับ Cognito ทุกครั้งที่เข้าถึงบอทหรือไม่?**
ตอบ: ไม่ การตรวจสอบสิทธิอนุญาตจะใช้โทเคน JWT เพื่อหลีกเลี่ยงการดำเนินการ I/O ที่ไม่จำเป็น

### ฟังก์ชันการค้นหา

**ถาม: การค้นหาบอทสนับสนุนการค้นหาเชิงความหมายหรือไม่?**
ตอบ: ไม่ สนับสนุนเพียงการจับคู่ข้อความบางส่วนเท่านั้น การค้นหาเชิงความหมาย (เช่น "automobile" → "car", "EV", "vehicle") ไม่สามารถทำได้เนื่องจากข้อจำกัดของ OpenSearch Serverless (มี.ค. 2025)