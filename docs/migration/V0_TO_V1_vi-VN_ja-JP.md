# 移行ガイド（v0からv1へ）

以前のバージョン（〜`0.4.x`）のBedrock Claude Chatを使用していた場合は、以下の手順に従って移行する必要があります。

## なぜこれを行う必要があるのか？

この重要な更新には、重要なセキュリティ更新が含まれています。

- ベクターデータベースストレージ（Aurora PostgreSQLの pgvector など）が現在暗号化されており、これにより展開時に置き換えがトリガーされます。これは、既存のベクターアイテムが削除されることを意味します。
- Cognitoユーザーグループ `CreatingBotAllowed` を導入し、botを作成できるユーザーを制限しました。既存のユーザーはこのグループに属していないため、botを作成できるようにする場合は、手動で権限を割り当てる必要があります。参照: [Botのパーソナライズ](../../README.md#bot-personalization)

## 前提条件

[データベース移行ガイド](./DATABASE_MIGRATION_vi-VN_ja-JP.md)を読み、アイテムのリストア方法を特定してください。

## 手順

### ベクターリポジトリの移動

- ターミナルを開き、プロジェクトディレクトリに移動
- デプロイしたいブランチをチェックアウトします。以下は目的のブランチ（この場合は `v1`）で、最新の変更をプルします：

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMSでアイテムを復元する場合、パスワードのローテーションを無効にし、データベースアクセス用のパスワードメモを忘れないでください。移行スクリプト（[migrate_v0_v1.py](./migrate_v0_v1.py)）で復元する場合、パスワードメモは不要です。
- CloudFormationが現在のAuroraクラスターを削除できるように、[公開済みのAPI](../PUBLISH_API_vi-VN_ja-JP.md)をすべて削除します。
- [npx cdk deploy](../README.md#deploy-using-cdk)を実行すると、Auroraクラスターが置き換えられ、すべてのベクターアイテムが削除されます。
- [データベース移行ガイド](./DATABASE_MIGRATION_vi-VN_ja-JP.md)に従って、ベクターアイテムを復元します。
- 既存のRAGボットを含む、ユーザーが既存のボットを使用できることを確認します。

### CreatingBotAllowedの権限を付与

- デプロイ後、すべてのユーザーは新しいボットを作成できなくなります。
- 特定のユーザーにボット作成を許可する場合は、管理コンソールまたはCLIを使用して、それらのユーザーを `CreatingBotAllowed` グループに追加します。
- ユーザーがボットを作成できるかどうかを確認します。ユーザーは再ログインする必要があることに注意してください。