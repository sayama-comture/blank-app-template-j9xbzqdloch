# マイグレーションガイド（v0 から v1）

以前のバージョンの Bedrock Claude Chat（約 `0.4.x`）を使用していた場合、以下の手順に従ってマイグレーションする必要があります。

## なぜこれを行う必要があるのか？

この重要な更新には、重要なセキュリティ更新が含まれています。

- ベクターデータベース（Aurora PostgreSQL の pgvector）のストレージが暗号化されました。これは、デプロイ時に置き換えがトリガーされることを意味します。つまり、既存のベクタープロジェクトは削除されます。
- ボットを作成できるユーザーを制限するために、`CreatingBotAllowed` Cognito ユーザーグループを導入しました。現在の既存ユーザーはこのグループに属していないため、ボット作成の権限を持たせたい場合は、手動で権限を付与する必要があります。詳細は以下を参照してください：[Bot のパーソナライズ](../../README.md#bot-personalization)

## 前提条件

阅读 [数据库迁移指南](./DATABASE_MIGRATION_zh-CN_ja-JP.md) 并确定復元プロジェクトの方法。

## 手順

### ベクターストレージの移行

- ターミナルを開き、プロジェクトディレクトリに移動します
- デプロイしたいブランチをプルします。対象のブランチ（この例では `v1`）に切り替え、最新の変更をプルします：

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMS を使用してプロジェクトを復元する場合は、パスワードローテーションを無効にし、データベースにアクセスするためのパスワードをメモしてください。移行スクリプト（[migrate_v0_v1.py](./migrate_v0_v1.py)）を使用する場合は、パスワードをメモする必要はありません。
- CloudFormation が既存の Aurora クラスターを削除できるように、[公開済みの API](../PUBLISH_API_zh-CN_ja-JP.md) をすべて削除します。
- [npx cdk deploy](../README.md#deploy-using-cdk) を実行して、Aurora クラスターの置換とすべてのベクタープロジェクトの削除をトリガーします。
- [データベース移行ガイド](./DATABASE_MIGRATION_zh-CN_ja-JP.md)に従ってベクタープロジェクトを復元します。
- 既存の知識を持つボット（RAG ボット）をユーザーが使用できることを確認します。

### CreatingBotAllowed 権限の追加

- デプロイ後、すべてのユーザーは新しいボットを作成できなくなります。
- 特定のユーザーにボットの作成を許可する場合は、管理コンソールまたは CLI を使用して、これらのユーザーを `CreatingBotAllowed` グループに追加します。
- ユーザーがボットを作成できることを確認します。ユーザーは再ログインする必要があることに注意してください。