# LLMエージェントの権限 (ReAct)

## Agent（ReAct）とは

Agentは、大規模言語モデル（LLM）を主要な計算エンジンとして使用する高度なAIシステムです。LLMの推論能力を、ツールの設計と使用などの追加機能と組み合わせて、複雑なタスクを自律的に実行します。Agentは、複雑な質問を分解し、ステップバイステップのソリューションを生成し、情報収集やサブタスクの実行のために外部のツールやAPIと対話できます。

この例では、[ReAct（Reasoning + Acting）](https://www.promptingguide.ai/techniques/react)アプローチを使用してAgentを実装しています。ReActにより、Agentは推論と行動を繰り返しのフィードバックループで組み合わせることで、複雑なタスクを解決できます。Agentは、3つの主要なステップ（思考、行動、観察）を繰り返し実行します。LLMを使用して現在の状況を分析し、次に取るべき行動を決定し、利用可能なツールやAPIを使用して行動を実行し、観察された結果から学習します。この継続的なプロセスにより、Agentは動的な環境に適応し、タスク解決の精度を向上させ、コンテキストに敏感なソリューションを提供できます。

## ユースケースの例

ReActを使用するエージェントは、さまざまなシナリオで正確かつ効率的なソリューションを提供できます。

### テキストからSQL

ユーザーが「最後の四半期の売上総額」を要求します。エージェントはこのリクエストを解釈し、SQLクエリに変換し、データベースに対して実行し、結果を提示します。

### 財務予測

財務アナリストは、次の四半期の収益を予測する必要があります。エージェントは関連するデータを収集し、財務モデルを使用して必要な計算を実行し、予測の詳細なレポートを生成し、予測の正確性を確保します。

## エージェント機能の使用方法

カスタムチャットボットのエージェント機能を有効にするには、次の手順に従ってください：

1. ボット固有の画面のエージェントセクションに移動します。

2. エージェントセクションで、エージェントが使用できるツールのリストが表示されます。デフォルトでは、すべてのツールは無効になっています。

3. ツールを有効にするには、目的のツールの横のスイッチをオンにするだけです。ツールが有効になると、エージェントはそれにアクセスでき、ユーザーの質問を処理する際に使用できます。

![](./imgs/agent_tools.png)

> [!重要]
> エージェントセクションでどのツールを有効にしても、自動的に["ナレッジ"](https://aws.amazon.com/what-is/retrieval-augmented-generation/)機能もツールとして扱われることに注意してください。これは、LLMがユーザーの質問に答える際に、利用可能なツールの1つとして「ナレッジ」を自律的に使用するかどうかを判断することを意味します。

4. デフォルトでは、「インターネット検索」ツールが提供されています。このツールにより、エージェントはユーザーの質問に答えるためにインターネットから情報を取得できます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは、レート制限のある[DuckDuckGo](https://duckduckgo.com/)に依存しています。概念実証（PoC）またはデモ目的には適していますが、本番環境で使用する場合は、他の検索APIの使用をお勧めします。

5. エージェントの機能を拡張するために、独自の特殊なツールを開発して追加できます。カスタムツールの作成と統合の詳細については、[独自のツールの開発方法](#how-to-develop-your-own-tools)セクションを参照してください。

## あなた独自のツールを構築する方法

エージェント用の独自のカスタムツールを構築するには、以下のガイドラインに従ってください：

- `AgentTool` クラスを継承する新しいクラスを作成します。インターフェースはLangChainと互換性がありますが、この例の実装では独自の `AgentTool` クラスを提供しており、それを継承する必要があります（[ソース](../backend/app/agents/tools/agent_tool.py)）。

- [BMI計算](../examples/agents/tools/bmi/bmi.py)ツールの実装例を参照してください。この例は、ユーザー入力に基づいて体格指数（BMI）を計算するツールの作成方法を示しています。

  - ツールで宣言された名前と説明は、LLMがユーザーの質問に答えるためにどのツールを使用すべきかを検討する際に使用されます。つまり、LLMを呼び出す指示に埋め込まれます。したがって、できるだけ正確に説明することをお勧めします。

- [オプション] 独自のカスタムツールを実装したら、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）を使用してその機能を検証することをお勧めします。このスクリプトは、ツールが期待通りに機能することを確認するのに役立ちます。

- カスタムツールの開発とテストが完了したら、実装ファイルを [backend/app/agents/tools/](../backend/app/agents/tools/) ディレクトリに移動します。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py) を開き、ユーザーが構築したツールを選択できるように `get_available_tools` を編集します。

- [オプション] ユーザーインターフェースに明確な名前と説明を追加します。このステップはオプションですが、これを行わない場合、ツールで宣言された名前と説明が使用されます。これはLLM用であり、ユーザー用ではないため、より良いUXのために特定の説明を追加することをお勧めします。

  - i18nファイルを編集します。[en/index.ts](../frontend/src/i18n/en/index.ts) を開き、`agent.tools` に独自の `name` と `description` を追加します。
  - `xx/index.ts` も編集します。ここで、`xx` は希望の国コードを表します。

- 変更を適用するには、`npx cdk deploy` を実行します。これにより、カスタムツールが特定のボット画面で利用可能になります。

## 寄付

**このリポジトリへの寄付を歓迎します！** 便利で適切に実装されたツールを開発している場合は、課題を提出またはプルリクエストを送信することで、プロジェクトに貢献することを検討してください。