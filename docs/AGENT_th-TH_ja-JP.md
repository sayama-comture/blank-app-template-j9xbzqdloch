# LLM 駆動のエージェント (ReAct)

## ReAct エージェントとは？

ReAct エージェントは、大規模言語モデル（LLMs）を主要な計算ツールとして使用する高度な人工知能システムです。LLMsの推論能力を、計画や道具の使用などの追加機能と統合し、複雑なタスクを自律的に実行します。エージェントは複雑な命令を識別し、段階的なソリューションを作成し、情報収集や部分的な作業のために外部のツールやAPIと対話できます。

この例では、[ReAct（推論 + 行動）](https://www.promptingguide.ai/techniques/react)アプローチに従うエージェントを使用しています。ReActは、推論と行動を反復的なフィードバックループで組み合わせることで、エージェントが複雑な問題を解決できるようにします。エージェントは、主に3つのステップを通じて動作します：思考、行動、観察。LLMを使用して現在の状況を分析し、次の行動を決定し、利用可能なツールやAPIを使用して行動を実行し、観察された結果から学習します。この継続的なプロセスにより、エージェントは変化する環境に適応し、問題解決の精度を向上させ、文脈を考慮したソリューションを提供できます。

## 使用例

ReActエージェントは、さまざまな状況で正確で効率的なソリューションを提供できます。

### SQLへの変換

ユーザーが「前四半期の総売上」について尋ねると、エージェントはこのリクエストを解釈し、SQLコマンドに変換してデータベースで処理し、結果を提示します。

### 財務予測

財務アナリストは次の四半期の収益を予測する必要があります。エージェントは関連データを収集し、財務モデルを使用して計算を実行し、予測の精度を確保するための詳細な予測レポートを作成します。

## Agentの機能の使用

カスタムチャットボットのAgent機能を有効にするには、次の手順に従ってください：

1. カスタムチャットボット画面のAgent セクションに移動します

2. Agentセクションで、デフォルトで利用可能なツールのリストが表示されます。すべてのツールは無効になっています。

3. ツールを有効にするには、目的のツールの横にあるスイッチを押します。ツールが有効になると、Agentはユーザーのクエリを処理する際にそのツールにアクセスして使用できるようになります。

![](./imgs/agent_tools.png)

> [!重要]
> Agentセクションで任意のツールを有効にすると、["Knowledge"](https://aws.amazon.com/what-is/retrieval-augmented-generation/) 機能もツールとして扱われます。これは、LLMが自動的に「Knowledge」を使用してユーザーの質問に答えるかどうかを決定することを意味します。

4. デフォルトでは、「Internet Search」ツールが用意されています。このツールにより、AgentはユーザーのクエリにAに答えるためにインターネットから情報を取得できます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは[DuckDuckGo](https://duckduckgo.com/)に依存しており、使用制限があります。実験またはデモンストレーションには適していますが、本番環境で使用する場合は、他の検索APIを使用することをお勧めします。

5. Agentの機能を拡張するために、カスタムツールを開発して追加できます。詳細については、[独自のツールを開発する方法](#how-to-develop-your-own-tools)のセクションを参照してください。

## カスタムツールの開発方法

エージェント用のカスタムツールを開発するには、以下のガイドラインに従ってください：

- `AgentTool` クラスを継承する新しいクラスを作成します。LangChainとの互換性があるインターフェースですが、この例では独自の `AgentTool` クラスを使用し、継承する必要があります（[ソース](../backend/app/agents/tools/agent_tool.py)）。

- [BMI計算ツール](../examples/agents/tools/bmi/bmi.py)の使用例を参照してください。この例は、ユーザーが入力した情報に基づいてBMI（ボディマス指数）を計算するツールの作成方法を示しています。

  - ツールで宣言された名前と説明は、LLMがユーザーの質問に答えるためにどのツールを使用すべきかを判断する際に使用されます。言い換えれば、LLM呼び出し時にプロンプトに埋め込まれるため、できるだけ明確に説明する必要があります。

- [オプション] カスタムツールを開発した後、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）を使用して機能を確認することをお勧めします。このスクリプトにより、ツールが期待通りに動作することを確認できます。

- カスタムツールの開発とテストが完了したら、実装ファイルを [backend/app/agents/tools/](../backend/app/agents/tools/) ディレクトリに移動します。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py) を開き、ユーザーが開発したツールを選択できるように `get_available_tools` を編集します。

- [オプション] フロントエンドの名前と説明を明確に追加します。このステップはオプションですが、追加しない場合、ツールで宣言された名前と説明がLLM用に使用され、ユーザー向けではありません。そのため、UXを改善するために特定の説明を追加することをお勧めします。

  - i18nファイルを編集します。[en/index.ts](../frontend/src/i18n/en/index.ts) を開き、`agent.tools` にあなたの `name` と `description` を追加します。
  - 同様に、`xx` が目的の国コードである `xx/index.ts` も編集します。

- `npx cdk deploy` を実行して変更をデプロイし、カスタムツールをカスタムボット画面で使用可能にします。

## コントリビューション

**ツールキットへのコントリビューションを歓迎します！** 有用で優れたツールを開発した場合は、Issue の作成または Pull Request を送信することで、プロジェクトにツールを提供することを検討してください。