# LLMによって支援されたエージェント（ReAct）

## Agent (ReAct) とは何か？

Agentは、大規模言語モデル（LLMs）を中心的な計算エンジンとして使用する先進的なAIシステムです。LLMsの推論能力を、計画立案やツール使用などの追加機能と組み合わせ、複雑なタスクを自動的に実行します。Agentは、複雑なクエリを分析し、段階的なソリューションを生成し、情報収集や補助的なタスク実行のために外部ツールやAPIと対話できます。

このモデルは、[ReAct（Reasoning + Acting）](https://www.promptingguide.ai/techniques/react)メソッドを使用してAgentを実装します。ReActにより、agentは推論と行動を繰り返しのフィードバックループで組み合わせることで、複雑なタスクを解決できます。Agentは、思考、行動、観察の3つの主要なステップを継続的に経験します。LLMを使用して現在の状況を分析し、次に取るべき行動を決定し、利用可能なツールやAPIを使用して行動を実行し、観察結果から学習します。このような継続的なプロセスにより、agentは動的な環境に適応し、タスク解決の精度を向上させ、文脈に応じたソリューションを提供できます。

## ユースケースの例

ReActエージェントは、さまざまなシナリオに適用でき、正確で効果的な解決策を提供することができます。

### テキストからSQLへの変換

ユーザーが「前四半期の総売上高」を要求した場合、エージェントはこのリクエストを理解し、SQLクエリに変換し、データベース上でクエリを実行し、結果を提示します。

### 財務予測

財務アナリストが次の四半期の売上を予測する必要がある場合、エージェントは関連するデータを収集し、財務モデルを使用して必要な計算を実行し、予測の正確性を確保しながら、詳細な予測レポートを作成します。

## エージェント機能の使用

カスタムチャットボットのエージェント機能を有効にするには、次の手順に従ってください：

1. カスタムボット画面のエージェントセクションに移動します。

2. エージェントセクションで、エージェントが使用できる利用可能なツールのリストが表示されます。デフォルトでは、すべてのツールは無効になっています。

3. ツールを有効にするには、目的のツールの横にあるスイッチを切り替えるだけです。ツールが有効になると、エージェントはそのツールにアクセスでき、ユーザーのクエリを処理する際に使用できます。

![](./imgs/agent_tools.png)

> [!重要]
> エージェントセクションで任意のツールを有効にすると、「ナレッジ」機能が自動的にツールとして扱われることに注意することが重要です。これは、LLMがユーザーのクエリに応答するために「ナレッジ」を使用するかどうかを自動的に判断し、利用可能なツールの1つとして扱うことを意味します。

4. デフォルトでは、「インターネット検索」ツールが提供されています。このツールにより、エージェントはユーザーの質問に答えるためにインターネットから情報を取得できます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは[DuckDuckGo](https://duckduckgo.com/)のレート制限に依存しています。これは概念実証（PoC）またはデモンストレーション目的には適していますが、本番環境で使用する場合は、別の検索APIを使用することをお勧めします。

5. エージェントの機能を拡張するために、独自のカスタムツールを開発して追加できます。カスタムツールの作成と統合の詳細については、[独自のツールの開発方法](#how-to-develop-your-own-tools)のセクションを参照してください。

## 独自のツールを開発する方法

エージェント用のカスタムツールを開発するには、次のガイドラインに従ってください：

- `AgentTool`クラスを継承する新しいクラスを作成します。LangChainと互換性のあるインターフェースですが、このテンプレート実装は独自の`AgentTool`クラスを提供し、継承する必要があります（[ソース](../backend/app/agents/tools/agent_tool.py)）。

- [BMIツールの実装](../examples/agents/tools/bmi/bmi.py)を参考にしてください。この例は、ユーザー入力に基づいてBMI（体格指数）を計算するツールの作成方法を示しています。

  - 名前と説明は、LLMがユーザーの質問に応答するためにどのツールを使用すべきかを検討する際に使用されます。つまり、プロンプトに埋め込まれます。そのため、できるだけ正確に記述する必要があります。

- [オプション] カスタムツールを実装した後、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）でその機能を検証する必要があります。このスクリプトは、ツールが期待通りに動作することを確認するのに役立ちます。

- カスタムツールの開発とテストが完了したら、実装ファイルを[backend/app/agents/tools/](../backend/app/agents/tools/)ディレクトリに移動します。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py)を開き、`get_available_tools`を編集して、開発したツールをユーザーが選択できるようにします。

- [オプション] ユーザーインターフェース用に明確な名前と説明を追加します。このステップはオプションですが、実行しない場合、ツールで宣言された名前と説明がLLM用に使用されます。ユーザー向けではないため、ユーザーエクスペリエンスを改善するために専用の説明を追加することをお勧めします。

  - i18nファイルを編集します。[en/index.ts](../frontend/src/i18n/en/index.ts)を開き、`agent.tools`に独自の`name`と`description`を追加します。
  - 同様に`xx/index.ts`を編集します。`xx`は対象の国コードを表します。

- `npx cdk deploy`を実行して変更をデプロイします。これにより、カスタムツールがカスタムボット画面で利用可能になります。

## 貢献

**ツールリポジトリへの貢献を歓迎しています！** 有用で適切に実装されたツールを開発した場合は、issueまたはプルリクエストを送信することで、プロジェクトに貢献することを検討してください。