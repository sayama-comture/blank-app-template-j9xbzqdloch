# LLM ベースのエージェント (ReAct)

## ReActエージェントとは何か？

エージェントは、大規模言語モデル（LLM）を中央計算エンジンとして活用する高度なAIシステムです。これは、LLMの推論能力を計画やツール使用などの追加機能と組み合わせて、複雑なタスクを自律的に実行します。エージェントは、複雑なクエリを分析し、ステップバイステップのソリューションを生成し、外部ツールやAPIと対話して情報を収集したり、サブタスクを実行したりできます。

このサンプルは、[ReAct（推論 + 行動）](https://www.promptingguide.ai/techniques/react)アプローチを使用してエージェントを実装します。ReActにより、エージェントは推論と行動を反復的なフィードバックループで結合し、複雑なタスクを解決できます。エージェントは、思考（Thought）、行動（Action）、観察（Observation）の3つの主要なステップを反復的に実行します。LLMを使用して現在の状況を分析し、次に取るべき行動を決定し、利用可能なツールやAPIを使用して行動を実行し、観察された結果から学習します。この継続的なプロセスを通じて、エージェントは動的な環境に適応し、タスク解決の精度を向上させ、状況に応じたソリューションを提供できます。

## ユースケースの例

ReActを使用するエージェントは、さまざまなシナリオで正確で効率的なソリューションを提供できます。

### テキスト-to-SQL

ユーザーが「前四半期の総売上」を要求します。エージェントはこのリクエストを解釈し、SQLクエリに変換した後、データベースに対して実行し、結果を提示します。

### 財務予測

財務アナリストが次の四半期の収益を予測する必要があります。エージェントは関連データを収集し、財務モデルを使用して必要な計算を実行した後、予測の正確性を保証する詳細な予測レポートを生成します。

## エージェント機能の使用

カスタムチャットボットのエージェント機能を有効化するには、次の手順に従ってください：

1. カスタムボット画面でエージェントセクションに移動します。

2. エージェントセクションで、エージェントが利用可能なツールのリストを見つけることができます。デフォルトでは、すべてのツールは無効化されています。

3. ツールを有効化するには、目的のツールの横にあるスイッチを切り替えます。ツールが有効化されると、エージェントはそのツールにアクセスでき、ユーザークエリの処理に活用できます。

![](./imgs/agent_tools.png)

> [!重要]
> エージェントセクションでツールを有効化すると、["ナレッジ"機能](https://aws.amazon.com/what-is/retrieval-augmented-generation/)も自動的にツールとして扱われます。これは、LLMが利用可能なツールの1つとして「ナレッジ」を使用するかどうかを自律的に決定することを意味します。

4. デフォルトで「インターネット検索」ツールが提供されます。このツールにより、エージェントはユーザーの質問に答えるためにインターネットから情報を取得できます。

![](./imgs/agent1.png)
![](./imgs/agent2.png)

このツールは[DuckDuckGo](https://duckduckgo.com/)に依存しており、速度制限があります。概念実証（PoC）またはデモ目的には適していますが、本番環境で使用する場合は、他の検索APIを使用することをお勧めします。

5. エージェントの機能を拡張するために、カスタムツールを開発して追加できます。カスタムツールの作成と統合の詳細については、[独自のツールの開発方法](#how-to-develop-your-own-tools)セクションを参照してください。

## 独自のツールの開発方法

エージェント用のカスタムツールを開発するには、次のガイドラインに従ってください：

- `AgentTool` クラスを継承する新しいクラスを作成してください。インターフェースはLangChainと互換性がありますが、このサンプル実装では直接 `AgentTool` クラスを提供するため、これを継承する必要があります（[ソース](../backend/app/agents/tools/agent_tool.py)）。

- [BMI計算ツール](../examples/agents/tools/bmi/bmi.py)のサンプル実装を参考にしてください。この例は、ユーザー入力に基づいて体格指数（BMI）を計算するツールの作成方法を示しています。

  - ツールに宣言された名前と説明は、LLMがユーザーの質問に応答するためのツールを検討する際に使用されます。つまり、LLMを呼び出す際のプロンプトに含まれます。そのため、可能な限り正確に説明することをお勧めします。

- [オプション] カスタムツールを実装した後、テストスクリプト（[例](../examples/agents/tools/bmi/test_bmi.py)）を使用して機能を確認することをお勧めします。このスクリプトは、ツールが期待通りに動作するかを確認するのに役立ちます。

- カスタムツールの開発とテストを完了したら、実装ファイルを [backend/app/agents/tools/](../backend/app/agents/tools/) ディレクトリに移動してください。次に、[backend/app/agents/utils.py](../backend/app/agents/utils.py)を開き、`get_available_tools`を編集して、ユーザーが開発されたツールを選択できるようにしてください。

- [オプション] フロントエンド用の明確な名前と説明を追加してください。このステップはオプションですが、実行しない場合、ツールに宣言された名前と説明が使用されます。これはLLM用であり、ユーザー用ではないため、より良いUXのために専用の説明を追加することをお勧めします。

  - i18nファイルを編集してください。[en/index.ts](../frontend/src/i18n/en/index.ts)を開き、`agent.tools`に一意の`name`と`description`を追加してください。
  - `xx/index.ts`も編集してください。ここで、`xx`は目的の国コードを表します。

- `npx cdk deploy`を実行して変更を展開してください。これにより、カスタムツールをカスタムボット画面で使用できるようになります。

## コントリビューション

**ツールリポジトリへのコントリビューションを歓迎します！** 有用で適切に実装されたツールを開発した場合、課題やプルリクエストを提出してプロジェクトに貢献することを検討してください。